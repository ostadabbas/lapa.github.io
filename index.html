<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAPA: Look Around and Pay Attention</title>
    <!-- Clean modern font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #111;
        }
        h2, h3, h4, h5, h6 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-top: 30px;
            color: #111; /* solid black */
            background: none;
            -webkit-text-fill-color: initial;
            animation: none;
            display: block;
        }
        .authors {
            text-align: center;
            margin-bottom: 30px;
            font-style: italic;
        }
        .abstract {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
            text-align: justify;
        }
        .main-image {
            width: 100%;
            max-width: 1000px;
            margin: 20px auto;
            display: block;
        }
        
        .gradient-text-animate {
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradientFlow 4s ease infinite;
            font-weight: bold;
        }
        
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .result-item {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }
        .result-item img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
        .category-section {
            margin-top: 40px;
        }
        .category-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        footer {
            margin-top: 50px;
            text-align: center;
            font-size: 0.9em;
            color: #7f8c8d;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .citation {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 30px;
        }
        
        /* Animation styles */
        @keyframes fadeIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .logo-animation {
            opacity: 0;
            animation: fadeIn 1.5s ease-out forwards;
        }
        /* Interactive architecture figure */
        .arch-interactive {
            position: relative;
            display: block;
            max-width: 100%;
            margin: 16px 0 8px;
        }
        .arch-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 6px;
        }
        .arch-hotspot {
            position: absolute;
            top: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
            border: 2px dashed rgba(255, 215, 0, 0.0);
            cursor: pointer;
        }
        .arch-hotspot:hover,
        .arch-hotspot.active {
            opacity: 1; /* make highlight clear */
            background: rgba(255, 215, 0, 0.22);
            border-color: rgba(255, 215, 0, 0.65);
            box-shadow: inset 0 0 0 2px rgba(255, 215, 0, 0.85), 0 0 12px rgba(255, 215, 0, 0.65);
        }
        .method-list li { transition: background-color 0.15s ease; }
        .method-list li.highlight { background: rgba(255, 215, 0, 0.18); }
        
        .gradient-text {
            background: linear-gradient(to right, #3498db, #2c3e50, #9b59b6, #3498db);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientFlow 3s ease-in-out forwards;
            animation-delay: 1s;
        }
        
        /* Animation showcase styles - simplified for natural display */
        .animation-showcase {
            margin: 40px 0;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
        }
        
        .animation-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 5px;
        }
        
        .animation-item {
            overflow: hidden;
            background-color: #f9f9f9;
        }
        
        .animation-item img, .animation-item video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .animation-3d {
            grid-column: 1 / -1;
            text-align: center;
            background-color: #f9f9f9;
            margin-top: 5px;
        }
        
        .animation-3d img, .animation-3d video {
            max-width: 100%;
            max-height: 400px;
        }
        
        /* Architecture section styles */
        .architecture-section {
            margin: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .architecture-image {
            max-width: 100%;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .architecture-image-2 {
            max-width:90%;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .pipeline-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            margin-top: 30px;
        }
        
        .pipeline-item {
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 15px;
            background-color: #fff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .pipeline-item img {
            width: 100%;
            height: auto;
            border-radius: 5px;
        }
        
        /* Video Gallery Styles */
        .video-gallery-container {
            margin: 40px 0;
            position: relative;
        }
        
        .category-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category-btn {
            padding: 8px 16px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .category-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .video-gallery-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            max-width: 900px;
        }
        
        .video-gallery {
            width: 100%;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .video-item {
            width: 100%;
            text-align: center;
        }
        
        .video-player {
            width: 100%;
            max-height: 500px;
            background-color: #000;
        }
        
        /* Additional styles for better video display */
        .video-wrapper {
            position: relative;
            width: 100%;
            background-color: #000;
            aspect-ratio: 4.25/1; /* Based on the 1904x448 video dimensions */
            overflow: hidden;
        }
        
        .video-fallback {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
        }
        
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            background-color: rgba(0,0,0,0.5);
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 5;
        }
        
        .video-title {
            padding: 10px;
            margin: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            font-weight: 500;
        }
        
        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background-color: rgba(0,0,0,0.8);
        }
        
        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .prev-btn {
            left: -20px;
        }
        
        .next-btn {
            right: -20px;
        }
        
        .pagination-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .dot.active {
            background-color: #3498db;
            transform: scale(1.2);
        }

        /* LAPA button and GIF reveal styles */
        .lapa-button {
            position: relative; /* now outside the player */
            background: linear-gradient(90deg, #ff0040, #ff7f00, #ffd21e, #00e676, #00b0ff, #6a5acd, #ff00ff);
            background-size: 400% 400%;
            color: #000;
            border: none;
            border-radius: 22px;
            padding: 8px 14px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 0 rgba(255,255,255,0.0), 0 4px 10px rgba(0,0,0,0.25);
            transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.2s ease;
            animation: lapaRainbow 4s linear infinite, lapaRainbowGlow 2.2s ease-in-out infinite;
            z-index: 15;
        }
        .lapa-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.28);
            filter: brightness(1.06);
        }
        /* Button bar above the player */
        .lapa-button-bar {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 10px;
            margin-bottom: 10px;
        }
        .click-hint {
            font-weight: 600;
            color: #ffffff;
            opacity: 0.9;
            animation: hintPulse 1.2s ease-in-out infinite;
            user-select: none;
        }
        @keyframes hintPulse {
            0%, 100% { transform: translateX(0); opacity: 0.9; }
            50% { transform: translateX(3px); opacity: 1; }
        }
        /* Global container shown below the video gallery to avoid sticking */
        .lapa-global-container {
            display: none;
            margin-top: 42px;
        }
        .lapa-global-container.open { display: block; }
        .lapa-panel {
            background-color: #ffffff; /* white panel background */
            border: 1px solid #eeeeee; /* subtle border for separation */
            border-radius: 10px;
            padding: 10px 14px;
            animation: fadeIn 0.25s ease-out;
            box-shadow: 0 6px 14px rgba(255, 255, 255, 0.08);
        }
        /* Make GIF area look like the video player */
        .lapa-gif-wrapper {
            position: relative;
            width: 100%;
            background-color: #ffffff;
            aspect-ratio: 4.25/1; /* match .video-wrapper ratio */
            overflow: hidden;
            border-radius: 8px;
        }
        .lapa-gif {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #ffffff;
            display: block;
        }

        @keyframes lapaRainbow { /* animated rainbow background */
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes lapaRainbowGlow { /* cycling glow colors */
            0%   { box-shadow: 0 0 18px rgba(255, 0, 64, 0.75), 0 6px 14px rgba(0,0,0,0.28); }
            16%  { box-shadow: 0 0 18px rgba(255,127,0,0.75),   0 6px 14px rgba(0,0,0,0.28); }
            33%  { box-shadow: 0 0 18px rgba(255,210,30,0.75),  0 6px 14px rgba(0,0,0,0.28); }
            50%  { box-shadow: 0 0 18px rgba(0,230,118,0.75),   0 6px 14px rgba(0,0,0,0.28); }
            66%  { box-shadow: 0 0 18px rgba(0,176,255,0.75),   0 6px 14px rgba(0,0,0,0.28); }
            83%  { box-shadow: 0 0 18px rgba(106,90,205,0.75),  0 6px 14px rgba(0,0,0,0.28); }
            100% { box-shadow: 0 0 18px rgba(255, 0,255,0.75),  0 6px 14px rgba(0,0,0,0.28); }
        }
    </style>
</head>
<body>
    <div style="text-align: center; display: flex; align-items: center; justify-content: center; margin-bottom: 20px;">
        <img src="assets/lapa_logo.png" alt="LAPA Logo" style="height: 100px; margin-right: 20px;" class="logo-animation">
        <div>
            <h1 class="gradient-text">LAPA: Look Around and Pay Attention</h1>
            <h2 class="gradient-text">Multi-camera Point Tracking Reimagined with Transformers</h2>
        </div>
    </div>
    
    <div class="authors">
        Bishoy Galoaa, Xiangyu Bai, Shayda Moezzi, Utsav Nandi, Sai Siddhartha Vivek Dhir Rangoju, Somaieh Amraee, Sarah Ostadabbas
        <br>
        Northeastern University
        <br>
        <em>Accepted as Oral Presentation at 3DV</em>
    </div>
    
    <div style="text-align: center; margin: 10px 0 30px;">
        <a href="https://arxiv.org/abs/2512.04213" style="display: inline-block; background-color: #b31b1b; color: white; padding: 8px 15px; margin: 0 5px; border-radius: 4px; text-decoration: none;">
            <span style="display: flex; align-items: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="white" style="margin-right: 5px;"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>
                arXiv:2512.04213
            </span>
        </a>
        <a href="https://github.com/ostadabbas/Look-Around-and-Pay-Attention-LAPA-" style="display: inline-block; background-color: #333; color: white; padding: 8px 15px; margin: 0 5px; border-radius: 4px; text-decoration: none;">
            <span style="display: flex; align-items: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="white" style="margin-right: 5px;"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                GitHub
            </span>
        </a>
    </div>
    
    <!-- Simple GIF Animations Display -->
    <div class="section-header">
        <h2>3D Trajectories Visualization</h2>
        <p class="section-description">Our system captures movements from multiple 2D camera views (top) and reconstructs them into a 3D model (below). In the 3D visualization, trajectory points <span class="gradient-text-animate">are colored based on their visibility</span>: if the first point of a track is occluded, it's shown in the track's color; otherwise, it inherits the color from the corresponding 2D pixel in the track.</p>
    </div>
    <section class="animation-showcase">
        <!-- 2D Camera Views Side by Side -->
        <div class="animation-grid">
            <div class="animation-item">
                <img src="assets/gifs/2d_animation_5.gif" alt="2D Tracking View 1">
            </div>
            <div class="animation-item">
                <img src="assets/gifs/2d_animation_6.gif" alt="2D Tracking View 2">
            </div>
            <div class="animation-item">
                <img src="assets/gifs/2d_animation_7.gif" alt="2D Tracking View 3">
            </div>
        </div>
        
        <!-- 3D Reconstruction Below -->
        <div class="animation-3d">
            <img src="assets/gifs/3d_animation_5_6_7.gif" alt="3D Reconstruction">
        </div>
    </section>
    
    <h2>Overview</h2>
    <div class="abstract">
        <p>
            LAPA (Look Around and Pay Attention) is a novel end-to-end transformer-based architecture for multi-camera point tracking. Unlike traditional approaches that separate detection, association, and tracking into distinct stages, LAPA jointly reasons across views and time through attention mechanisms. By encoding epipolar geometry directly into cross-view attention, LAPA creates a differentiable mechanism that optimizes appearance and geometric consistency simultaneously. This allows the system to handle occlusions effectively by shifting attention to views where points remain visible, maintaining continuous tracking even through complex motion patterns.
        </p>
    </div>
    
    <section class="architecture-section">
        <h2>LAPA Architecture</h2>
        <p>
            Our approach employs a unified framework that integrates all stages of detection, correspondence, and tracking into a differentiable pipeline.
        </p>
        
        <!-- Interactive model figure (pipeline removed as requested) -->
        <div class="arch-interactive" id="arch-figure">
            <img src="assets/lapa_model.png" alt="LAPA Model Architecture" class="arch-image">
            <!-- Four logical blocks left-to-right matching the key components list -->
            <div class="arch-hotspot" data-index="0" style="left:0%; width:25%;"></div>
            <div class="arch-hotspot" data-index="1" style="left:25%; width:25%;"></div>
            <div class="arch-hotspot" data-index="2" style="left:50%; width:25%;"></div>
            <div class="arch-hotspot" data-index="3" style="left:75%; width:25%;"></div>
        </div>
        
        <p>The key components include:</p>
        <ul class="method-list" id="method-list">
            <li><strong>2D Point Tracking + Feature Extraction:</strong> Co-Tracker tracks points over time and a ViT extracts appearance features.</li>
            <li><strong>Geometric‚ÄëAware Attention + Points & Tracks Correspondence:</strong> Cross‚Äëview matching guided by geometry and appearance.</li>
            <li><strong>3D Track Reconstruction (Differentiable Triangulation):</strong> Predicts 3D points consistently over time.</li>
            <li><strong>Volumetric Attention Grid ‚Üí 3D Trajectories:</strong> Aggregates multi‚Äëview evidence to form final trajectories.</li>
        </ul>
    </section>
    
    <h2>Results</h2>
    
    <div class="video-gallery-container">
        <div class="category-buttons">
            <button class="category-btn active" data-category="boxes">Boxes</button>
            <button class="category-btn" data-category="basketball">Basketball</button>
            <button class="category-btn" data-category="football">Football</button>
            <button class="category-btn" data-category="softball">Softball</button>
            <button class="category-btn" data-category="tennis">Tennis</button>
            <button class="category-btn" data-category="juggle">Juggling</button>
        </div>
        
        <div class="video-gallery-wrapper">
            <button class="nav-btn prev-btn">‚ùÆ</button>
            <div class="video-gallery">
                <!-- Videos will be loaded here dynamically -->
            </div>
            <button class="nav-btn next-btn">‚ùØ</button>
        </div>
        
        <!-- Global LAPA reveal container (separate from the video player) -->
        <div class="lapa-global-container"></div>
        
        <div class="pagination-dots">
            <!-- Dots will be added dynamically -->
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Architecture figure hover sync with method list
            (function() {
                const hotspots = Array.from(document.querySelectorAll('.arch-hotspot'));
                const methodItems = Array.from(document.querySelectorAll('#method-list li'));
                if (hotspots.length === 4 && methodItems.length >= 4) {
                    const setHighlight = (idx) => {
                        methodItems.forEach((li, i) => li.classList.toggle('highlight', i === idx));
                        hotspots.forEach((hs, i) => hs.classList.toggle('active', i === idx));
                    };
                    hotspots.forEach((hs, i) => {
                        hs.addEventListener('mouseenter', () => setHighlight(i));
                        hs.addEventListener('mouseleave', () => setHighlight(-1));
                    });
                    methodItems.forEach((li, i) => {
                        li.addEventListener('mouseenter', () => setHighlight(i));
                        li.addEventListener('mouseleave', () => setHighlight(-1));
                    });
                }
            })();
            // Function to ensure GIFs keep looping
            function ensureGifsLoop() {
                const gifImages = document.querySelectorAll('.animation-item img, .animation-3d img, .lapa-gif');
                gifImages.forEach(img => {
                    // Use base src (strip any existing query) to prevent stacking cache-busters
                    const baseSrc = img.src.split('?')[0];
                    img.src = baseSrc + '?t=' + Date.now();
                });
            }
            
            // Run initially and then every 10 seconds to ensure GIFs keep looping
            ensureGifsLoop();
            setInterval(ensureGifsLoop, 10000);
            
            // Video data structure - auto-wired to assets/converted_videos_for_web batches
            const videoData = {
                'basketball': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Basketball - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Basketball - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_basketball_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Basketball - Camera Config 03'
                    }
                ],
                'boxes': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Boxes - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Boxes - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_boxes_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Boxes - Camera Config 03'
                    }
                ],
                'football': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Football - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Football - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_football_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Football - Camera Config 03'
                    }
                ],
                'juggle': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Juggling - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Juggling - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_juggle_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Juggling - Camera Config 03'
                    }
                ],
                'softball': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Softball - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Softball - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_softball_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Softball - Camera Config 03'
                    }
                ],
                'tennis': [
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_01/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_01/all_tracks_3d_enhanced.gif',
                        title: 'Tennis - Camera Config 01'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_02/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_02/all_tracks_3d_enhanced.gif',
                        title: 'Tennis - Camera Config 02'
                    },
                    {
                        mp4Path: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_03/comprehensive_tracks_video_web.mp4',
                        gifPath: 'assets/converted_videos_for_web/batch_reconstruction_tennis_combo_03/all_tracks_3d_enhanced.gif',
                        title: 'Tennis - Camera Config 03'
                    }
                ]
            };
            
            const gallery = document.querySelector('.video-gallery');
            const categoryBtns = document.querySelectorAll('.category-btn');
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            const paginationDots = document.querySelector('.pagination-dots');
            const lapaGlobal = document.querySelector('.lapa-global-container');
            
            let currentCategory = 'boxes';
            let currentIndex = 0;
            
            // Load videos for a category - completely rewritten for simplicity and reliability
            function loadVideos(category) {
                gallery.innerHTML = '';
                paginationDots.innerHTML = '';
                // clear and hide global LAPA panel on category load
                if (lapaGlobal) { lapaGlobal.classList.remove('open'); lapaGlobal.innerHTML = ''; }
                
                const videos = videoData[category];
                
                videos.forEach((video, index) => {
                    // Create a container for this video
                    const videoItem = document.createElement('div');
                    videoItem.className = 'video-item';
                    videoItem.style.display = index === currentIndex ? 'block' : 'none';
                    
                    // Create title element
                    const title = document.createElement('p');
                    title.className = 'video-title';
                    title.textContent = video.title;
                    
                    // Create a video wrapper with better styling
                    const videoWrapper = document.createElement('div');
                    videoWrapper.className = 'video-wrapper';
                    
                    // Create the actual video element
                    const videoHTML = `
                        <video 
                            controls 
                            autoplay
                            muted
                            loop 
                            preload="auto"
                            playsinline 
                            class="video-player"
                            poster="assets/lapa_logo.png"
                            onclick="this.play()">
                            <source src="${video.mp4Path}" type="video/mp4">
                            Your browser does not support HTML5 video.
                        </video>
                    `;
                    videoWrapper.innerHTML = videoHTML;

                    // Get the video element we just created
                    const videoElement = videoWrapper.querySelector('video');
                    // Ensure autoplay compatibility on Chrome/Edge
                    try {
                        videoElement.muted = true;
                        videoElement.autoplay = true;
                        videoElement.playsInline = true;
                        // Try to play immediately
                        const playPromise = videoElement.play();
                        if (playPromise && typeof playPromise.then === 'function') {
                            playPromise.catch(err => {
                                console.warn('Autoplay blocked, will rely on user gesture. Showing controls.', err);
                                videoElement.controls = true;
                            });
                        }
                    } catch (e) {
                        console.warn('Error attempting autoplay setup:', e);
                    }
                    
                    // Fallback to GIF if MP4 fails to load (Chrome/Edge codec issues)
                    const fallbackToGif = () => {
                        if (videoWrapper.querySelector('img.video-fallback')) return;
                        const img = document.createElement('img');
                        img.className = 'video-fallback';
                        img.alt = `${video.title} - Fallback`;
                        img.src = `${video.gifPath}?t=${Date.now()}`;
                        videoWrapper.innerHTML = '';
                        videoWrapper.appendChild(img);
                        console.warn('Using GIF fallback for:', video.mp4Path);
                    };

                    let isLoaded = false;
                    videoElement.addEventListener('loadeddata', function() {
                        isLoaded = true;
                        console.log('Video loaded successfully:', video.mp4Path);
                    });
                    videoElement.addEventListener('canplaythrough', function() {
                        isLoaded = true;
                    });
                    videoElement.addEventListener('error', function(e) {
                        console.error('Video error:', this.error, e);
                        fallbackToGif();
                    });
                    // If not ready after a short delay, assume unsupported and fallback
                    setTimeout(() => { if (!isLoaded) fallbackToGif(); }, 3500);

                    // Retry play when tab becomes visible (helps with mobile/autoplay policies)
                    document.addEventListener('visibilitychange', () => {
                        if (!document.hidden && videoItem.style.display !== 'none') {
                            if (videoElement.paused) {
                                videoElement.play().catch(() => {});
                            }
                        }
                    });
                    
                    // Add click handler to the entire video item to ensure playback works
                    videoItem.addEventListener('click', function() {
                        if (videoElement.paused) {
                            videoElement.play().catch(e => {
                                console.error('Could not play video:', e);
                            });
                        }
                    });
                    
                    // LAPA button bar above the player with a hint
                    const buttonBar = document.createElement('div');
                    buttonBar.className = 'lapa-button-bar';
                    const hint = document.createElement('span');
                    hint.className = 'click-hint';
                    hint.textContent = 'Click me ‚û°';
                    const lapaBtn = document.createElement('button');
                    lapaBtn.className = 'lapa-button';
                    lapaBtn.textContent = 'LAPA';
                    lapaBtn.title = 'Look Around and Pay Attention';
                    lapaBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        if (!lapaGlobal) return;
                        const cacheBust = `?t=${Date.now()}`; // force animate on reveal
                        const panelHTML = `
                            <div class="lapa-panel">
                                <div class="lapa-gif-wrapper">
                                    <img class="lapa-gif" src="${video.gifPath}${cacheBust}" alt="${video.title} - Enhanced GIF" />
                                </div>
                            </div>`;
                        const currentlyOpen = lapaGlobal.classList.contains('open');
                        const showingSame = currentlyOpen && lapaGlobal.dataset.src === video.gifPath;
                        if (showingSame) {
                            lapaGlobal.classList.remove('open');
                            lapaGlobal.innerHTML = '';
                            lapaGlobal.dataset.src = '';
                        } else {
                            lapaGlobal.innerHTML = panelHTML;
                            lapaGlobal.classList.add('open');
                            lapaGlobal.dataset.src = video.gifPath;
                        }
                    });
                    buttonBar.appendChild(hint);
                    buttonBar.appendChild(lapaBtn);

                    // Add elements to the video item
                    videoItem.appendChild(buttonBar);
                    videoItem.appendChild(videoWrapper);
                    videoItem.appendChild(title);
                    gallery.appendChild(videoItem);
                    
                    // Create pagination dot
                    const dot = document.createElement('span');
                    dot.className = 'dot' + (index === currentIndex ? ' active' : '');
                    dot.dataset.index = index;
                    dot.addEventListener('click', () => {
                        navigateToIndex(index);
                    });
                    paginationDots.appendChild(dot);
                });
                
                updateNavButtons();
            }
            
            // Navigate to a specific index
            function navigateToIndex(index) {
                const videos = document.querySelectorAll('.video-item');
                const dots = document.querySelectorAll('.dot');
                
                videos.forEach((video, i) => {
                    video.style.display = i === index ? 'block' : 'none';
                });
                
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
                
                currentIndex = index;
                updateNavButtons();
            }
            
            // Update navigation buttons state
            function updateNavButtons() {
                const videos = videoData[currentCategory];
                prevBtn.disabled = currentIndex === 0;
                nextBtn.disabled = currentIndex === videos.length - 1;
            }
            
            // Event listeners for category buttons
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    currentIndex = 0;
                    loadVideos(currentCategory);
                });
            });
            
            // Event listeners for navigation buttons
            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    navigateToIndex(currentIndex - 1);
                }
            });
            
            nextBtn.addEventListener('click', () => {
                const videos = videoData[currentCategory];
                if (currentIndex < videos.length - 1) {
                    navigateToIndex(currentIndex + 1);
                }
            });
            
            // Initialize with first category
            loadVideos(currentCategory);
            
            // Add a click event to the document to help with autoplay
            document.addEventListener('click', function() {
                const videos = document.querySelectorAll('video');
                videos.forEach(video => {
                    if (video.paused) {
                        video.play().catch(e => console.log('Play prevented:', e));
                    }
                });
            }, { once: true });
        });
    </script>
    
    <h2>Demo</h2>
    <section style="margin: 40px 0;">
        <div style="max-width: 1000px; margin: 30px auto; background-color: #f9f9f9; padding: 25px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0,0,0,0.15);">
            <video class="video-player" controls muted loop playsinline preload="auto" style="width: 100%; height: auto; display: block; border-radius: 8px; object-fit: contain;">
                <source src="assets/converted_videos/lapa_interactive_demo.mp4" type="video/mp4">
                <source src="assets/converted_videos/lapa_interactive_demo.webm" type="video/webm">
                Your browser does not support the video tag.
            </video>
        </div>
        <div style="display: flex; justify-content: center; margin: 30px 0;">
            <a href="#" style="display: flex; align-items: center; background-color: #FFD21E; color: #000; padding: 15px 30px; border-radius: 30px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,0.2); font-size: 18px; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.25)'" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'">
                <svg width="32" height="32" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 12px;">
                    <path d="M41.1 34.7C41.1 33.3 42.3 32.1 43.7 32.1H59.5C60.9 32.1 62.1 33.3 62.1 34.7V85.3C62.1 86.7 60.9 87.9 59.5 87.9H43.7C42.3 87.9 41.1 86.7 41.1 85.3V34.7Z" fill="black"/>
                    <path d="M66.4 34.7C66.4 33.3 67.6 32.1 69 32.1H84.8C86.2 32.1 87.4 33.3 87.4 34.7V85.3C87.4 86.7 86.2 87.9 84.8 87.9H69C67.6 87.9 66.4 86.7 66.4 85.3V34.7Z" fill="black"/>
                    <path d="M15.7 60C15.7 58.6 16.9 57.4 18.3 57.4H34.1C35.5 57.4 36.7 58.6 36.7 60V85.3C36.7 86.7 35.5 87.9 34.1 87.9H18.3C16.9 87.9 15.7 86.7 15.7 85.3V60Z" fill="black"/>
                    <path d="M91.7 60C91.7 58.6 92.9 57.4 94.3 57.4H110.1C111.5 57.4 112.7 58.6 112.7 60V85.3C112.7 86.7 111.5 87.9 110.1 87.9H94.3C92.9 87.9 91.7 86.7 91.7 85.3V60Z" fill="black"/>
                </svg>
                Interactive Demo Coming Soon üöÄ
            </a>
        </div>
        <div class="abstract" style="margin-top: 30px; padding: 25px; font-size: 1.1em;">
            <p>
                In this demo, the user picks tracking points in 2D in any view. Using the trained correspondence model and camera calibration, 
                we find the corresponding points in other views and then track them in 3D. Upon acceptance, the interactive demo will be released on HuggingFace.
            </p>
        </div>
    </section>

    <h2>Citation</h2>
    <div class="citation">
@article{anonymous2025lapa,
  title={LAPA: Look Around and Pay Attention: Multi-camera Point Tracking Reimagined with Transformers},
  author={Anonymous},
  journal={3DV 2026},
  year={2026}
}
    </div>
    
    <footer>
        <p>¬© 2025 LAPA Research Team</p>

    </footer>
</body>
</html>
